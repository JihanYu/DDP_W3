---
title: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r reading data}
pml.training <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv", header=TRUE)
pml.testing <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv", header=TRUE)
```

```{r preprocessing}
library(caret);  library(ggplot2);  library(rattle)

training <- pml.training[, c(8:160)]
factor.id <- which(sapply(training, is.factor));  factor.n <- length(factor.id)

for(i in factor.id[-factor.n]){
  training[, i] <- as.character(training[, i])
  training[, i] <- as.numeric(training[, i])
}
training[is.na(training)] <- 0

inTrain <- createDataPartition(training$classe, p=0.7, list=FALSE)
training.in <- training[inTrain,];  testing.in <- training[-inTrain,]
dim(training.in);  dim(testing.in)
```

```{r modeling - tree}
modFit.rpart <- train(classe ~ ., method="rpart", data=training.in)
print(modFit.rpart)
fancyRpartPlot(modFit.rpart$finalModel)

pr.train.rpart <- predict(modFit.rpart, newdata=training.in)
confusionMatrix(pr.train.rpart, training.in$classe)

pr.test.rpart <- predict(modFit.rpart, newdata=testing.in)
confusionMatrix(pr.test.rpart, testing.in$classe)
```


```{r prediction}
testing <- pml.testing[, c(8:160)]
factor.id <- which(sapply(testing, is.factor));  factor.n <- length(factor.id)

for(i in factor.id[-factor.n]){
  testing[, i] <- as.character(testing[, i])
  testing[, i] <- as.numeric(testing[, i])
}

testing[is.na(testing)] <- 0
predict(modFit.rpart, newdata=testing)
```


```{r modeling - unsupervised kmeans}
kMeans1 <- kmeans(subset(training.in, select=-c(classe)), centers=5)

res.kmeans <- kMeans1$cluster
res.kmeans[res.kmeans==1] <- "A";  res.kmeans[res.kmeans==2] <- "B";  
res.kmeans[res.kmeans==3] <- "C";  res.kmeans[res.kmeans==4] <- "D";  
res.kmeans[res.kmeans==5] <- "E"
res.kmeans <- as.factor(res.kmeans)
training.in$clusters <- res.kmeans

confusionMatrix(training.in$clusters, training.in$classe)

modFit.kmeans <- train(clusters ~ ., data=subset(training.in, select=-c(classe)), method="rpart")
pr.train.kmeans <- predict(modFit.kmeans, newdata=training.in)
confusionMatrix(pr.train.kmeans, training.in$classe)

pr.test.kmeans <- predict(modFit.kmeans, newdata=testing.in)
confusionMatrix(pr.test.kmeans, testing.in$classe)

predict(modFit.kmeans, newdata=testing)
```



modFit.rf <- train(classe ~ ., method="rf", data=training.in, prox=TRUE)
print(modFit.rf)
# Error 로 수행 불가
#getTree(modFit.rf$finalModel, k=5)
#
#pr.train.rf <- predict(modFit.rf, newdata=training.in)
#confusionMatrix(training.in$classe, pr.train.rf)

#pr.test.rf <- predict(modFit.rf, newdata=testing.in)
#confusionMatrix(testing.in$classe, pr.test.rf)

modFit.lda <- train(classe ~ ., method="lda", data=training.in)
# Error 로 불가
# print(modFit.lda)
#pr.train.lda <- predict(modFit.lda, newdata=training.in)
#confusionMatrix(training.in$classe, pr.train.lda)
#pr.test.lda <- predict(modFit.lda, newdata=testing.in)
#confusionMatrix(testing.in$classe, pr.test.lda)

modFit.nb <- train(classe ~ ., method="nb", data=training.in)
print(modFit.nb)

pr.train.nb <- predict(modFit.nb, newdata=training.in)
confusionMatrix(training.in$classe, pr.train.nb)

pr.test.nb <- predict(modFit.nb, newdata=testing.in)
confusionMatrix(testing.in$classe, pr.test.nb)

preObj <- preProcess(tr.red[, -factor.n], method="knnImpute")
res <- predict(preObj, tr.red[, -factor.n])

